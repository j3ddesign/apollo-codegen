{"version":3,"sources":["../src/downloadSchema.js"],"names":["defaultHeaders","url","outputPath","additionalHeaders","insecure","headers","agent","Agent","rejectUnauthorized","result","response","method","body","json","error","message","errors","schemaData","data","writeFileSync","downloadSchema"],"mappings":";;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;AAMA;;;;AAbA;;AAeA,MAAMA,iBAAiB;AACrB,YAAU,kBADW;AAErB,kBAAgB;AAFK,CAAvB;;;6CAKe,WAA8BC,GAA9B,EAAmCC,UAAnC,EAA+CC,iBAA/C,EAAkEC,QAAlE,EAA4E;AACzF,UAAMC,UAAU,sBAAcL,cAAd,EAA8BG,iBAA9B,CAAhB;AACA,UAAMG,QAAQF,WAAW,IAAI,gBAAMG,KAAV,CAAgB,EAAEC,oBAAoB,KAAtB,EAAhB,CAAX,GAA4D,IAA1E;;AAEA,QAAIC,MAAJ;AACA,QAAI;AACF,YAAMC,WAAW,MAAM,yBAAMT,GAAN,EAAW;AAChCU,gBAAQ,MADwB;AAEhCN,iBAASA,OAFuB;AAGhCO,cAAM,yBAAe,EAAE,sCAAF,EAAf,CAH0B;AAIhCN;AAJgC,OAAX,CAAvB;;AAOAG,eAAS,MAAMC,SAASG,IAAT,EAAf;AACD,KATD,CASE,OAAOC,KAAP,EAAc;AACd,YAAM,sBAAe,oDAAmDA,MAAMC,OAAQ,EAAhF,CAAN;AACD;;AAED,QAAIN,OAAOO,MAAX,EAAmB;AACjB,YAAM,sBAAe,yCAAwCP,OAAOO,MAAO,EAArE,CAAN;AACD;;AAED,UAAMC,aAAaR,MAAnB;AACA,QAAI,CAACQ,WAAWC,IAAhB,EAAsB;AACpB,YAAM,sBAAe,oEAAmE,yBAAeT,MAAf,CAAuB,EAAzG,CAAN;AACD;;AAED,iBAAGU,aAAH,CAAiBjB,UAAjB,EAA6B,yBAAee,UAAf,EAA2B,IAA3B,EAAiC,CAAjC,CAA7B;AACD,G;;WA5B6BG,c;;;;SAAAA,c","file":"downloadSchema.js","sourcesContent":["// Based on https://facebook.github.io/relay/docs/guides-babel-plugin.html#using-other-graphql-implementations\r\n\r\nimport fetch from 'node-fetch';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport https from 'https';\r\n\r\nimport {\r\n  buildClientSchema,\r\n  introspectionQuery,\r\n  printSchema,\r\n} from 'graphql/utilities';\r\n\r\nimport { ToolError } from './errors'\r\n\r\nconst defaultHeaders = {\r\n  'Accept': 'application/json',\r\n  'Content-Type': 'application/json'\r\n};\r\n\r\nexport default async function downloadSchema(url, outputPath, additionalHeaders, insecure) {\r\n  const headers = Object.assign(defaultHeaders, additionalHeaders);\r\n  const agent = insecure ? new https.Agent({ rejectUnauthorized: false }) : null;\r\n\r\n  let result;\r\n  try {\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers: headers,\r\n      body: JSON.stringify({ 'query': introspectionQuery }),\r\n      agent,\r\n    });\r\n\r\n    result = await response.json();\r\n  } catch (error) {\r\n    throw new ToolError(`Error while fetching introspection query result: ${error.message}`);\r\n  }\r\n\r\n  if (result.errors) {\r\n    throw new ToolError(`Errors in introspection query result: ${result.errors}`);\r\n  }\r\n\r\n  const schemaData = result;\r\n  if (!schemaData.data) {\r\n    throw new ToolError(`No introspection query result data found, server responded with: ${JSON.stringify(result)}`);\r\n  }\r\n\r\n  fs.writeFileSync(outputPath, JSON.stringify(schemaData, null, 2));\r\n}\r\n"]}